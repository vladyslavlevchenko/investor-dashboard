<div class="securities-container">
  <div class="header">
    <h2>Securities</h2>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="toggleCsvImport()">
        {{ showCsvImport() ? 'Cancel' : 'üìÅ Import CSV' }}
      </button>
      <button class="btn btn-primary" (click)="toggleAddForm()">
        {{ showAddForm() ? 'Cancel' : '+ Add Security' }}
      </button>
    </div>
  </div>

  @if (error()) {
    <div class="alert alert-error">
      {{ error() }}
    </div>
  }

  @if (showCsvImport()) {
    <app-csv-import (importComplete)="onCsvImportComplete()"></app-csv-import>
  }

  @if (showAddForm()) {
    <div class="add-form">
      <h3>Add New Security</h3>
      <form (ngSubmit)="addSecurity()">
        <div class="form-group">
          <label for="ticker">Ticker Symbol</label>
          <input 
            type="text" 
            id="ticker"
            [(ngModel)]="newSecurity.ticker" 
            name="ticker"
            placeholder="e.g., AAPL"
            required
            [disabled]="loading()"
          />
        </div>

        <div class="form-group">
          <label for="name">Company Name</label>
          <input 
            type="text" 
            id="name"
            [(ngModel)]="newSecurity.name" 
            name="name"
            placeholder="e.g., Apple Inc."
            required
            [disabled]="loading()"
          />
        </div>

        <div class="form-group">
          <label for="assetClass">Asset Class</label>
          <input 
            type="text" 
            id="assetClass"
            [(ngModel)]="newSecurity.assetClass" 
            name="assetClass"
            placeholder="e.g., US Equity"
            required
            [disabled]="loading()"
          />
        </div>

        <button type="submit" class="btn btn-primary" [disabled]="loading()">
          {{ loading() ? 'Adding...' : 'Add Security' }}
        </button>
      </form>
    </div>
  }

  @if (loading() && securities().length === 0) {
    <div class="loading">Loading securities...</div>
  }

  @if (!loading() && securities().length === 0) {
    <div class="empty-state">
      <p>No securities found. Add your first security to get started!</p>
    </div>
  }

  @if (securities().length > 0) {
    <div class="securities-table">
      <table>
        <thead>
          <tr>
            <th>Ticker</th>
            <th>Name</th>
            <th>Asset Class</th>
            <th>Current Price</th>
            <th>Added</th>
          </tr>
        </thead>
        <tbody>
          @for (security of securities(); track security.id) {
            <tr>
              <td class="ticker">{{ security.ticker }}</td>
              <td>{{ security.name }}</td>
              <td>{{ security.assetClass }}</td>
              <td class="price">
                @if (getPrice(security.ticker); as price) {
                  ${{ price.toFixed(2) }}
                } @else {
                  <span class="loading-price">Loading...</span>
                }
              </td>
              <td class="date">{{ security.createdAt | date: 'short' }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
